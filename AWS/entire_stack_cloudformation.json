{ 
   "AWSTemplateFormatVersion":"2010-09-09",
   "Resources":{ 
      "SeqrLambdaService":{ 
         "Type":"AWS::Lambda::Function",
         "Properties":{ 
            "Code":{ 
               "S3Bucket":"bch-seqr-student-test-bucket",
               "S3Key":"lambda_cloudformation.jar"
            },
            "Description":"This is our Seqr Scala service",
            "Handler":"example.ScalaLambda::handleRequest",
            "Runtime":"java8",
            "Role":"arn:aws:iam::771890318051:role/service-role/secret_manager",
            "MemorySize":512,
            "Timeout":15
         }
      },
      "SeqrLambdaAPI":{ 
         "Type":"AWS::ApiGateway::RestApi",
         "Properties":{ 
            "Name":"lambdaservice",
            "Description":"This is a test API",
            "FailOnWarnings":true
         }
      },
      "LambdaFunctionPermissionGet":{ 
         "Type":"AWS::Lambda::Permission",
         "Properties":{ 
            "Action":"lambda:invokeFunction",
            "FunctionName":{ 
               "Fn::GetAtt":[ 
                  "SeqrLambdaService",
                  "Arn"
               ]
            },
            "Principal":"apigateway.amazonaws.com",
            "SourceArn":{ 
               "Fn::Join":[ 
                  "",
                  [ 
                     "arn:aws:execute-api:",
                     { 
                        "Ref":"AWS::Region"
                     },
                     ":",
                     { 
                        "Ref":"AWS::AccountId"
                     },
                     ":",
                     { 
                        "Ref":"SeqrLambdaAPI"
                     },
                     "/*"
                  ]
               ]
            }
         }
      },
      "ApiDeployment":{ 
         "Type":"AWS::ApiGateway::Deployment",
         "DependsOn":[ 
            "ApiMethodGet"
         ],
         "Properties":{ 
            "RestApiId":{ 
               "Ref":"SeqrLambdaAPI"
            },
            "StageName":"dev"
         }
      },
      "ApiResourceRoot":{ 
         "Type":"AWS::ApiGateway::Resource",
         "Properties":{ 
            "RestApiId":{ 
               "Ref":"SeqrLambdaAPI"
            },
            "ParentId":{ 
               "Fn::GetAtt":[ 
                  "SeqrLambdaAPI",
                  "RootResourceId"
               ]
            },
            "PathPart":"lambdaservice"
         }
      },
      "ApiMethodGet":{ 
         "DependsOn":"LambdaFunctionPermissionGet",
         "Type":"AWS::ApiGateway::Method",
         "Properties":{ 
            "ResourceId":{ 
               "Ref":"ApiResourceRoot"
            },
            "RestApiId":{ 
               "Ref":"SeqrLambdaAPI"
            },
            "HttpMethod":"POST",
            "AuthorizationType":"NONE",
            "Integration":{ 
               "Type":"AWS",
               "IntegrationHttpMethod":"POST",
               "IntegrationResponses":[ 
                  { 
                     "StatusCode":200
                     
                  }
               ],
               "Uri":{ 
                  "Fn::Join":[ 
                     "",
                     [ 
                        "arn:aws:apigateway:",
                        { 
                           "Ref":"AWS::Region"
                        },
                        ":lambda:path/2015-03-31/functions/",
                        { 
                           "Fn::GetAtt":[ 
                              "SeqrLambdaService",
                              "Arn"
                           ]
                        },
                        "/invocations"
                     ]
                  ]
               }
            },
            "MethodResponses": [ 
                { "StatusCode": 200, "ResponseModels": { "application/json": "Empty" } } ]
         }
      }
   }
}